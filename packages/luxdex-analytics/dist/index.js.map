{"version":3,"sources":["../src/index.ts","../src/analytics.ts","../src/Trace.tsx","../src/TraceEvent.tsx"],"sourcesContent":["export * from './analytics'\nexport * from './Trace'\nexport * from './TraceEvent'\nexport * from './types'\n","import {\n  init,\n  track,\n  identify,\n  Identify,\n  getDeviceId as amplitudeGetDeviceId,\n  getUserId as amplitudeGetUserId,\n  getSessionId as amplitudeGetSessionId,\n} from '@amplitude/analytics-browser'\n\nexport interface AnalyticsConfig {\n  /** Proxy URL for analytics endpoint */\n  proxyUrl?: string\n  /** Whether this is a production environment */\n  isProductionEnv?: boolean\n  /** Enable debug logging */\n  debug?: boolean\n  /** Report user's country */\n  reportOriginCountry?: boolean\n}\n\nexport enum OriginApplication {\n  INTERFACE = 'interface',\n  MOBILE = 'mobile',\n  EXTENSION = 'extension',\n}\n\nexport const ANONYMOUS_DEVICE_ID = '00000000-0000-0000-0000-000000000000'\n\nlet isInitialized = false\nexport let analyticsConfig: AnalyticsConfig | undefined\n\n/**\n * Initializes analytics with API key.\n *\n * @param apiKey API key for analytics service\n * @param originApplication Name of the application\n * @param config Configuration options\n */\nexport function initializeAnalytics(\n  apiKey: string,\n  originApplication: OriginApplication,\n  config?: AnalyticsConfig\n): void {\n  // Non-production environments may use hot-reloading, which will re-initialize but should be ignored.\n  if (!config?.isProductionEnv && isInitialized) {\n    return\n  }\n\n  if (config?.isProductionEnv) {\n    if (isInitialized) {\n      throw new Error('initializeAnalytics called multiple times. Ensure it is outside of a React component.')\n    }\n    if (config.debug) {\n      throw new Error(\n        `It looks like you're trying to initialize analytics in debug mode for production. Disable debug mode or use a non-production environment.`\n      )\n    }\n  }\n\n  isInitialized = true\n  analyticsConfig = config\n\n  init(\n    apiKey,\n    /* userId= */ undefined, // User ID should be undefined to let Amplitude default to Device ID\n    /* options= */\n    {\n      // Configure the SDK to work with alternate endpoint\n      serverUrl: config?.proxyUrl,\n      // Disable tracking of private user information\n      defaultTracking: false,\n    }\n  )\n}\n\n/** Sends an event to analytics. */\nexport function sendAnalyticsEvent(eventName: string, eventProperties?: Record<string, unknown>): void {\n  const origin = typeof window !== 'undefined' ? window.location.origin : 'unknown'\n\n  if (analyticsConfig?.debug) {\n    console.debug({\n      eventName,\n      eventProperties: { ...eventProperties, origin },\n    })\n  }\n\n  track(eventName, { ...eventProperties, origin })\n}\n\nexport function getDeviceId(): string | undefined {\n  return amplitudeGetDeviceId()\n}\n\nexport function getUserId(): string | undefined {\n  return amplitudeGetUserId()\n}\n\nexport function getSessionId(): number | undefined {\n  return amplitudeGetSessionId()\n}\n\n/**\n * Class that exposes methods to mutate the User Model's properties\n * that represents the current session's user.\n */\nclass UserModel {\n  private log(method: string, ...parameters: unknown[]): void {\n    console.debug(`[analytics(Identify)]: ${method}(${parameters})`)\n  }\n\n  private call(mutate: (event: Identify) => Identify): void {\n    if (!analyticsConfig?.isProductionEnv) {\n      const log = (_: unknown, method: string) => this.log.bind(this, method)\n      mutate(new Proxy(new Identify(), { get: log }) as Identify)\n      return\n    }\n    identify(mutate(new Identify()))\n  }\n\n  set(key: string, value: string | number | boolean | string[]): void {\n    this.call((event) => event.set(key, value))\n  }\n\n  setOnce(key: string, value: string | number | boolean | string[]): void {\n    this.call((event) => event.setOnce(key, value))\n  }\n\n  add(key: string, value: number): void {\n    this.call((event) => event.add(key, value))\n  }\n\n  postInsert(key: string, value: string | number): void {\n    this.call((event) => event.postInsert(key, value))\n  }\n\n  remove(key: string, value: string | number): void {\n    this.call((event) => event.remove(key, value))\n  }\n}\n\nexport const user = new UserModel()\n","import React, { createContext, memo, PropsWithChildren, useContext, useEffect, useMemo } from 'react'\nimport { sendAnalyticsEvent } from './analytics'\nimport { ITraceContext } from './types'\n\nexport const TraceContext = createContext<ITraceContext>({})\n\nexport function useTrace(): ITraceContext {\n  return useContext(TraceContext)\n}\n\ntype TraceProps = {\n  // Identifies the UI context (e.g., 'swap-page', 'pool-page')\n  page?: string\n  // Identifies the UI section (e.g., 'token-selector', 'swap-form')\n  section?: string\n  // Identifies the element (e.g., 'token-input', 'submit-button')\n  element?: string\n  // Additional properties to include in events\n  properties?: Record<string, unknown>\n  // Event to send on mount\n  logImpression?: boolean\n} & ITraceContext\n\n/**\n * Trace component that provides analytics context to children.\n * Optionally logs an impression event when mounted.\n */\nfunction TraceComponent({\n  children,\n  page,\n  section,\n  element,\n  properties,\n  logImpression,\n  ...parentContext\n}: PropsWithChildren<TraceProps>): React.JSX.Element {\n  const parentTrace = useTrace()\n\n  const combinedContext = useMemo(\n    () => ({\n      ...parentTrace,\n      ...parentContext,\n      page: page ?? parentTrace.page,\n      section: section ?? parentTrace.section,\n      element: element ?? parentTrace.element,\n    }),\n    [parentTrace, parentContext, page, section, element]\n  )\n\n  useEffect(() => {\n    if (logImpression) {\n      sendAnalyticsEvent('Impression', {\n        ...combinedContext,\n        ...properties,\n      })\n    }\n  }, [logImpression, combinedContext, properties])\n\n  return <TraceContext.Provider value={combinedContext}>{children}</TraceContext.Provider>\n}\n\nexport const Trace = memo(TraceComponent)\n","import React, {\n  Children,\n  cloneElement,\n  isValidElement,\n  memo,\n  PropsWithChildren,\n  ReactElement,\n  SyntheticEvent,\n  useCallback,\n} from 'react'\nimport { sendAnalyticsEvent } from './analytics'\nimport { useTrace } from './Trace'\n\ntype TraceEventProps = {\n  // The events to listen for\n  events: (keyof GlobalEventHandlersEventMap)[]\n  // The name of the event to send\n  name: string\n  // Additional properties to include in the event\n  properties?: Record<string, unknown>\n  // Element identifier\n  element?: string\n  // Whether to prevent default behavior\n  shouldLogImpression?: boolean\n}\n\n/**\n * TraceEvent component that wraps children and sends analytics events on specified DOM events.\n */\nfunction TraceEventComponent({\n  children,\n  events,\n  name,\n  properties,\n  element,\n}: PropsWithChildren<TraceEventProps>): React.JSX.Element {\n  const parentTrace = useTrace()\n\n  const handleEvent = useCallback(\n    (eventType: string, originalHandler?: (e: SyntheticEvent) => void) => (e: SyntheticEvent) => {\n      sendAnalyticsEvent(name, {\n        ...parentTrace,\n        element,\n        eventType,\n        ...properties,\n      })\n      originalHandler?.(e)\n    },\n    [name, parentTrace, element, properties]\n  )\n\n  const child = Children.only(children)\n\n  if (!isValidElement(child)) {\n    return <>{children}</>\n  }\n\n  const childProps = child.props as Record<string, unknown>\n  const eventHandlers: Record<string, (e: SyntheticEvent) => void> = {}\n\n  events.forEach((eventType) => {\n    const handlerName = `on${eventType.charAt(0).toUpperCase()}${eventType.slice(1)}` as keyof typeof childProps\n    const originalHandler = childProps[handlerName] as ((e: SyntheticEvent) => void) | undefined\n    eventHandlers[handlerName] = handleEvent(eventType, originalHandler)\n  })\n\n  return cloneElement(child as ReactElement, eventHandlers)\n}\n\nexport const TraceEvent = memo(TraceEventComponent)\n"],"mappings":"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","names":["OriginApplication","amplitudeGetDeviceId","amplitudeGetUserId","amplitudeGetSessionId","import_react","import_jsx_runtime"]}